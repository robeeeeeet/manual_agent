-- 00013_single_group_constraint.sql
-- 1ユーザー1グループ制約を追加
-- Phase 7: ワンタップ共有機能の前提条件

-- ============================================
-- 1. 既存データの検証（複数グループ参加ユーザーの確認）
-- ============================================
-- 注意: この制約を追加する前に、複数グループに参加しているユーザーがいないことを確認する必要があります。
-- 確認クエリ:
-- SELECT user_id, COUNT(*) as group_count
-- FROM group_members
-- GROUP BY user_id
-- HAVING COUNT(*) > 1;

-- ============================================
-- 2. 1ユーザー1グループ制約を追加
-- ============================================
-- ユーザーは1つのグループにのみ参加可能
ALTER TABLE public.group_members
ADD CONSTRAINT uq_group_members_user UNIQUE (user_id);

-- ============================================
-- 3. コメント: 制約の目的
-- ============================================
COMMENT ON CONSTRAINT uq_group_members_user ON public.group_members IS
'1ユーザー1グループ制約: ワンタップ共有機能のため、ユーザーは1つのグループにのみ参加可能';
