# Phase 0-3: メンテナンス項目抽出 検証レポート

## 概要

取扱説明書PDFからメンテナンス項目と周期を自動抽出する機能の実現可能性を検証。

## 検証結果

| 指標 | 結果 |
|------|------|
| **成功率** | **100%** (4/4) |
| **合計抽出項目数** | **70件** |
| **使用技術** | Gemini 2.5 Flash + PDF直接アップロード |

### 製品別抽出結果

| メーカー | 型番 | カテゴリ | 抽出項目数 | PDF容量 |
|----------|------|----------|------------|---------|
| 日立 | MRO-S7D | オーブンレンジ | 14件 | 13.5 MB |
| 象印 | CP-EA20 | 電気ポット | 12件 | 2.9 MB |
| 象印 | NW-JX10 | 炊飯器 | 37件 | 13.9 MB |
| タイガー | KAM-R132 | オーブントースター | 7件 | 2.2 MB |

---

## 抽出された情報の構造

各メンテナンス項目には以下の情報が含まれます：

```json
{
    "item_name": "項目名（例: 庫内の清掃）",
    "description": "詳細説明",
    "frequency": "周期（例: 使用後毎回, 週1回, 月1回）",
    "frequency_days": 30,  // 日数換算（リマインド計算用）
    "category": "cleaning/inspection/replacement/safety",
    "importance": "high/medium/low",
    "page_reference": "P.54"  // 記載ページ
}
```

---

## 抽出例（日立 MRO-S7D オーブンレンジ）

### 清掃項目（cleaning）

| 項目名 | 周期 | 重要度 |
|--------|------|--------|
| 加熱室内壁・ドア内側・保護カバーの清掃 | 使用後毎回 | high |
| スチーム小皿の清掃 | 使用後毎回 | high |
| テーブルプレートの清掃 | 使用後毎回 | high |
| 本体・付属品の外装清掃 | 適宜 | medium |
| 加熱室の汚れ清掃（スチーム機能利用） | 必要に応じて | medium |
| 加熱室の脱臭（空焼き） | 必要に応じて | medium |

### 点検項目（inspection）

| 項目名 | 周期 | 重要度 |
|--------|------|--------|
| 0点調節 | 必要に応じて | high |
| 長期使用の過熱水蒸気オーブンレンジの点検 | 定期的 | high |

### 安全確認項目（safety）

| 項目名 | 周期 | 重要度 |
|--------|------|--------|
| アース線の確実な取り付け確認 | 設置時 | high |
| 電源プラグ・コード・コンセントの確認 | 定期的/使用前 | high |
| 据え付け場所の確認 | 設置時 | high |

---

## 周期パターンの分析

抽出された周期パターン：

| パターン | 日数換算 | 例 |
|----------|----------|-----|
| 使用後毎回 | 1 | 加熱室清掃 |
| 毎日 | 1 | 残り湯を捨てる |
| 週1回 | 7 | フィルター清掃 |
| 月1回 | 30 | 内部点検 |
| 年1回 | 365 | 総合点検 |
| 適宜/必要に応じて | null | 外装清掃 |
| 使用前 | null | 安全確認 |

---

## 技術的アプローチ

### 処理フロー

```
1. PDFをGemini APIにアップロード（client.files.upload）
2. 処理完了を待機（state: PROCESSING → ACTIVE）
3. メンテナンス項目抽出プロンプトを送信
4. JSON形式で結果を取得
```

### 主要コード

```python
# PDFアップロード
file = client.files.upload(
    file=str(pdf_path),
    config=types.UploadFileConfig(
        display_name=pdf_path.stem,
        mime_type='application/pdf'
    )
)

# メンテナンス項目抽出
response = client.models.generate_content(
    model='gemini-2.5-flash',
    contents=[uploaded_file, prompt]
)
```

---

## 抽出精度の評価

### 良好な点

1. **項目の網羅性**: 清掃・点検・安全確認など多角的に抽出
2. **周期の識別**: 「使用後毎回」「週1回」「月1回」などを正確に識別
3. **ページ参照**: 元のPDFのページ番号を記載（ユーザーが確認可能）
4. **詳細説明**: 単なる項目名だけでなく、具体的な手順も抽出
5. **重要度判定**: high/medium/lowで優先順位付け

### 改善の余地

1. **周期の標準化**: 「適宜」「必要に応じて」の日数換算が難しい
2. **カテゴリ精度**: 一部の項目でcleaning/safetyの境界が曖昧
3. **言語混在**: 象印のPDFで英語訳が混在（日英併記マニュアル）

---

## コスト見積もり

### PDFサイズとトークン数の関係

| PDF | サイズ | 推定トークン数 |
|-----|--------|----------------|
| 日立 MRO-S7D | 13.5 MB | 約50,000 |
| 象印 CP-EA20 | 2.9 MB | 約15,000 |
| 象印 NW-JX10 | 13.9 MB | 約55,000 |
| タイガー KAM-R132 | 2.2 MB | 約12,000 |

### 1製品あたりの費用（Gemini 2.5 Flash）

| 項目 | トークン数 | 費用 |
|------|-----------|------|
| Input（PDF + プロンプト） | 約35,000 | $0.0105 |
| Output（JSON） | 約2,000 | $0.005 |
| **合計** | | **約$0.015/製品（約2.3円）** |

※ PDF容量による変動あり（2MB〜15MB）

---

## 結論

**Go判定: ✅ 実装可能**

- 成功率100%、高品質な抽出結果
- 周期・重要度・ページ参照など必要な情報を網羅
- Gemini APIのPDF直接アップロードで実装がシンプル
- コストも許容範囲（約2円/製品）

---

## 成果物

- スクリプト: `tests/phase0/scripts/test_maintenance_extraction.py`
- テストPDF: `tests/phase0/test_pdfs/`
- 抽出結果: `tests/phase0/results/maintenance_extraction_results.json`
