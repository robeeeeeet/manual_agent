# 要件定義書レビュー（`docs/requirements.md`）

作成日: 2026-01-02

## 総評（MVPとしての筋の良さ）

- **コアバリュー（画像→型番→公式PDF→メンテ抽出）**が明確で、MVPの3画面への落とし込みも妥当です。
- 技術スタック（Next.js + Supabase + GCS + Gemini）も、探索〜保管〜通知まで一貫しており現実的です。

## 追加すると強くなる「要件の抜け・曖昧点」

- **成功条件/KPI**: MVPの「成功」を何で判定するか（例：登録完了率、抽出精度、通知到達率、継続利用率）を1〜2個でも置くとブレません。
- **対応範囲（MVPでやらないこと）**: 例）OCRが失敗した時の再学習、メーカーサイト以外のPDF、RAG質問機能、家族共有の詳細、などを明示すると実装判断が速いです。
- **ユーザーフローの例外系**:
  - 画像認識できない／型番が複数候補／メーカー不明
  - 公式PDFが見つからない／見つかったが別型番／リンク切れ
  - PDFがスキャン画像でテキスト抽出不能
  - メンテ項目が抽出できない・周期が不明（「目安」表現）
- **“ユーザー確認”の具体**: 一時保存→正式保存の承認UIで、ユーザーが何を確認・修正できるのか（メーカー/型番/PDF/カテゴリ/抽出メンテ）を列挙すると良いです。
- **メンテ周期の定義**: 「○ヶ月ごと」「シーズン前」「毎使用後」などを **`interval_days` にどうマップするか**（変換ルール or “手動設定必須”）を決める必要があります。
- **通知仕様**:
  - いつ通知するか（当日朝/前日/期限超過で毎日など）
  - タイムゾーン、サイレント時間帯、頻度上限
  - ブラウザ制約（iOSのPWA/Pushの前提）を踏まえた代替（メール等）をMVPでどう扱うか
- **権限/共有（家族グループ）**: MVPで「招待制で共有」とある一方、将来拡張にも“家族グループ共有”があり重複しています。MVPでの最小要件（オーナー/メンバー権限、閲覧/編集/削除）を一行でも確定すると混乱が減ります。
- **データモデルの補強**:
  - `manuals`（PDF実体）を独立テーブルにするか（複数版・複数URL・言語対応に効く）
  - `appliances.manual_url` と `image_url` の「複数枚/複数マニュアル」要件の有無
  - `maintenance_schedules` に `timezone` / `notify_at` / `status`（pausedなど）を持つか
- **ストレージ設計**:
  - GCSの階層（カテゴリ/メーカー/型番）は良いですが、**リネーム**（型番修正）時の移動コスト・参照整合性をどうするか（IDベースのパスも検討余地）
  - temp→manuals への昇格条件と削除ポリシー（tempのTTL）
- **法務/コンプラ観点（最低限）**:
  - メーカーPDFの取得・保存が利用規約的に問題になり得るため、**「公式URLの保存のみ」オプション**や、出典表示・削除要請対応方針を要件に一文入れると安全です。
- **非機能要件**:
  - PDFサイズ上限、処理時間目標、同時実行、コスト上限（Gemini/GCS/検索）
  - ログ（失敗理由の収集）と監視（通知失敗率など）

## 画面要件（MVP3画面）をもう一段だけ具体化すると実装が早い

- **ログイン画面**: パスワードリセット有無、メール確認（confirm）フロー有無
- **家電一覧画面**: 並び順は「次回が近い順」とあるので、期限超過の扱い（最上位固定など）と、完了ボタンの配置（一覧で完了できるか）を確定
- **家電登録画面**: 「画像→解析→候補→確定→PDF取得→抽出→確認→登録」をステップUIにするか、単一フォームにするか

## AI要件（品質担保のための最小追加）

- **抽出結果のスキーマ**（例：task_name, interval, unit, condition, source_page）を定義すると、後工程（スケジュール化）が安定します。
- **根拠提示**: “どのページの記載か” を保存/表示できると、ユーザーの信頼が上がり修正もしやすいです。
- **手動修正の前提**: MVPは「AIが完全に正確」より、**人が直せる導線**が重要なので、その前提を要件に明記するのがおすすめです。

## 細かい指摘（整合性）

- **「家族グループ」**がMVP要件と将来拡張で重複しているため、MVPでは「単独ユーザーのみ」or「招待はするが権限は全員編集可」など、粒度を揃えると読みやすいです。
- DBモデルに `families.invite_code` があるので、**招待コード再発行**や漏洩時の無効化方針があると安心です。

## 次にやると良いこと（要件定義の仕上げ）

- **「MVPで確定する仕様」チェックリスト**（通知タイミング、周期変換ルール、例外系対応、共有の権限、PDFの扱い）を追記
- **受け入れ基準（Acceptance Criteria）**を各機能に2〜3行で追加（例：登録完了までに必ず手動入力にフォールバックできる、など）


