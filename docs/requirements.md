# 説明書管理 & メンテナンスリマインドアプリ - 要件定義書

## 1. 概要

家電や住宅設備の説明書を管理し、説明書に記載されたメンテナンス項目をリマインドするWebアプリ。
将来的には家電に限らず、説明書が存在するすべての商品に対応予定。

### コアバリュー（このアプリの肝）
1. **AI画像認識**: 商品の写真からメーカー・型番を読み取り（または外観から商品を推測し、ラベル位置を指示）
2. **AI説明書取得**: メーカー名・型番から公式マニュアルPDFを自動取得
3. **AIメンテナンス抽出**: マニュアルを解析し、メンテナンス項目・周期を正確に抽出

### ターゲットユーザー
- 個人/家族（自宅の家電・設備を管理したい一般ユーザー）

### プラットフォーム
- Webアプリ（PWA対応でスマホからも利用可能）

---

## 2. MVP機能要件

### 2.1 説明書検索・登録機能

| 機能 | 詳細 |
|------|------|
| 画像からの商品特定 | 商品写真やラベルをアップロード → AIが型番・メーカーを認識 |
| 手動入力 | メーカー名・型番をテキストで入力 |
| 説明書PDF取得 | Web検索で公式説明書PDFを取得・保存 |
| 手動アップロード | ユーザーが自分でダウンロードしたPDFをアップロード |
| 保存先検索優先 | まず既存ストレージを検索 → なければWeb検索 |

**フロー**
```
【自動取得】画像/型番入力 → AI解析 → ストレージ検索 → (なければ)Web検索 → 一時保存 → ユーザー確認 → 正式保存
【手動】ユーザーがPDFアップロード → メタ情報入力 → 正式保存
```

### 2.2 リマインド機能

| 機能 | 詳細 |
|------|------|
| メンテナンス項目抽出 | AIが説明書から全メンテナンス項目と周期を自動抽出 |
| スケジュール登録 | 抽出された項目を確認後、スケジュールとして登録 |
| Push通知 | PWA Push通知でスマホに通知 |
| 完了記録 | 作業完了をタップで記録、次回リマインド自動設定 |

### 2.3 ユーザー管理

| 機能 | 詳細 |
|------|------|
| メール+パスワード認証 | Supabase Authで実装 |
| 家族グループ | 招待制で家族とデータを共有 |

---

## 3. 将来的な拡張

- [ ] **家電詳細画面 + AIエージェント質問機能**（マニュアルを元に回答）
- [ ] **家電以外の商品対応**（車、自転車、家具、工具など説明書がある商品全般）
- [ ] 家族グループ共有機能
- [ ] LINE通知対応
- [ ] カテゴリ別RAGで質問対応・買い替え相談
- [ ] 動画アップロードによるトラブル対応
- [ ] 付属品購入リンク（Amazonアフィリエイト連携）
- [ ] 商品ごとのQAドキュメント自動生成

---

## 4. 技術スタック

### フロントエンド
- **Next.js 14+** (App Router)
- **TypeScript**
- **Tailwind CSS**
- **PWA対応** (next-pwa)

### バックエンド/データベース
- **Supabase**
  - PostgreSQL（データベース）
  - Auth（メール認証）
  - Edge Functions（APIロジック）

### ストレージ
- **Google Cloud Storage**
  - `temp/` バケット: 一時保存
  - `manuals/` バケット: 確認済み正式版
  - 階層: `カテゴリ/メーカー/型番/`

### AI/LLM
- **Gemini API**
  - 画像認識（型番・メーカー特定）
  - 説明書解析（メンテナンス項目・周期の抽出）
- **将来的に追加**: LangChain / LangGraph
  - AIエージェント質問機能実装時に導入
  - RAG（マニュアル検索）機能で活用

### 通知
- **Web Push API** (VAPID)
- Service Workerでバックグラウンド通知

---

## 5. データモデル

```
users
├── id, email, created_at

families (グループ)
├── id, name, owner_id, invite_code

family_members
├── family_id, user_id, role

appliances (家電)
├── id, family_id, name, maker, model_number, category
├── manual_url, image_url

maintenance_schedules (メンテナンス予定)
├── id, appliance_id, task_name, interval_days
├── last_done_at, next_due_at

maintenance_logs (実施記録)
├── id, schedule_id, done_at, done_by_user_id

push_subscriptions (通知設定)
├── id, user_id, endpoint, keys
```

---

## 6. 画面構成

### MVP（3画面）

1. **ログイン画面**
   - メール + パスワード認証
   - 新規登録

2. **家電一覧画面**
   - 次回作業実施日の近い順に表示
   - 各アイテムに次回メンテナンス日・内容を表示
   - Push通知設定へのリンク

3. **家電登録画面**
   - 画像アップロード or 手動入力
   - AI解析結果の確認
   - 説明書検索・取得
   - メンテナンス項目の確認・登録

### 将来的に追加

4. **家電詳細画面**
   - タップで一覧から遷移
   - 説明書PDF表示
   - メンテナンス履歴
   - **AIエージェントに質問**（マニュアルを元に回答）

5. **家族管理画面**
   - メンバー招待
   - 招待コード入力

---

## 7. 外部連携

| サービス | 用途 | 無料枠 |
|----------|------|--------|
| Supabase | DB/認証 | 500MB DB, 50K MAU |
| Google Cloud Storage | PDF保存 | 5GB/月 |
| Gemini API | 画像解析 | 60 QPM (無料) |
| Web Push | 通知 | 無料 |

---

## 8. 確定事項

- [x] **説明書の取得方法**: PDFダウンロード保存 + ユーザー手動アップロードの両対応
- [x] **カテゴリ**: 事前定義リスト + 「その他」で自由入力可能

### カテゴリ初期リスト

| カテゴリ | 例 |
|----------|-----|
| エアコン・空調 | エアコン、空気清浄機、除湿機 |
| 洗濯・乾燥 | 洗濯機、乾燥機 |
| キッチン | 冷蔵庫、電子レンジ、食洗機、炊飯器 |
| 給湯・暖房 | 給湯器、床暖房、ストーブ |
| 掃除 | 掃除機、ロボット掃除機 |
| 住宅設備 | 換気扇、24時間換気、インターホン |
| その他 | 自由入力 |
